<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 3 Species Richness Calculations | Source code for Using acoustics to evaluate the impact of forest restoration on bird communities in the Western Ghats</title>
  <meta name="description" content="Section 3 Species Richness Calculations | Source code for Using acoustics to evaluate the impact of forest restoration on bird communities in the Western Ghats" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 3 Species Richness Calculations | Source code for Using acoustics to evaluate the impact of forest restoration on bird communities in the Western Ghats" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="vjjan91/acoustics-westernGhats" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 3 Species Richness Calculations | Source code for Using acoustics to evaluate the impact of forest restoration on bird communities in the Western Ghats" />
  
  
  

<meta name="author" content="Vijay Ramesh" />
<meta name="author" content="Akshay VA" />
<meta name="author" content="VV Robin" />
<meta name="author" content="Ruth DeFries" />


<meta name="date" content="2021-06-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="splitting-large-wav-files-into-smaller-chunks.html"/>
<link rel="next" href="acoustic-detections.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#attribution"><i class="fa fa-check"></i><b>1.1</b> Attribution</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data-access"><i class="fa fa-check"></i><b>1.2</b> Data access</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#data-processing"><i class="fa fa-check"></i><b>1.3</b> Data processing</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="splitting-large-wav-files-into-smaller-chunks.html"><a href="splitting-large-wav-files-into-smaller-chunks.html"><i class="fa fa-check"></i><b>2</b> Splitting large .wav files into smaller chunks</a></li>
<li class="chapter" data-level="3" data-path="species-richness-calculations.html"><a href="species-richness-calculations.html"><i class="fa fa-check"></i><b>3</b> Species Richness Calculations</a></li>
<li class="chapter" data-level="4" data-path="acoustic-detections.html"><a href="acoustic-detections.html"><i class="fa fa-check"></i><b>4</b> Acoustic Detections</a></li>
<li class="chapter" data-level="5" data-path="jackknife-estimates.html"><a href="jackknife-estimates.html"><i class="fa fa-check"></i><b>5</b> Jackknife estimates</a></li>
<li class="chapter" data-level="6" data-path="non-metric-multidimensional-scaling-and-indicator-species-analysis.html"><a href="non-metric-multidimensional-scaling-and-indicator-species-analysis.html"><i class="fa fa-check"></i><b>6</b> Non-metric multidimensional scaling and indicator-species analysis</a></li>
<li class="chapter" data-level="7" data-path="preparing-vegetation-data-for-glms.html"><a href="preparing-vegetation-data-for-glms.html"><i class="fa fa-check"></i><b>7</b> Preparing vegetation data for GLMs</a></li>
<li class="chapter" data-level="8" data-path="generalized-linear-modeling-and-generalized-linear-mixed-modeling.html"><a href="generalized-linear-modeling-and-generalized-linear-mixed-modeling.html"><i class="fa fa-check"></i><b>8</b> Generalized linear modeling and generalized linear mixed modeling</a></li>
<li class="chapter" data-level="9" data-path="multiple-regression-of-distance-matrices.html"><a href="multiple-regression-of-distance-matrices.html"><i class="fa fa-check"></i><b>9</b> Multiple regression of distance matrices</a></li>
<li class="chapter" data-level="10" data-path="a-measure-of-vocal-activity.html"><a href="a-measure-of-vocal-activity.html"><i class="fa fa-check"></i><b>10</b> A measure of Vocal Activity</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Source code for <em>Using acoustics to evaluate the impact of forest restoration on bird communities in the Western Ghats</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="species-richness-calculations" class="section level1">
<h1><span class="header-section-number">Section 3</span> Species Richness Calculations</h1>
<p>In this script, we will calculate:</p>
<ol style="list-style-type: lower-alpha">
<li>Site-wise species richness to understand if species composition across treatment types are distinctly different.</li>
<li>Repeat the above three calculations, but using species traits - If a species is a rainforest specialist or an open-country generalist.</li>
</ol>
<p>Install required libraries</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb4-1"><a href="species-richness-calculations.html#cb4-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb4-2"><a href="species-richness-calculations.html#cb4-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb4-3"><a href="species-richness-calculations.html#cb4-3"></a><span class="kw">library</span>(stringr)</span>
<span id="cb4-4"><a href="species-richness-calculations.html#cb4-4"></a><span class="kw">library</span>(vegan)</span>
<span id="cb4-5"><a href="species-richness-calculations.html#cb4-5"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb4-6"><a href="species-richness-calculations.html#cb4-6"></a><span class="kw">library</span>(scico)</span>
<span id="cb4-7"><a href="species-richness-calculations.html#cb4-7"></a><span class="kw">library</span>(data.table)</span>
<span id="cb4-8"><a href="species-richness-calculations.html#cb4-8"></a><span class="kw">library</span>(ggpubr)</span>
<span id="cb4-9"><a href="species-richness-calculations.html#cb4-9"></a></span>
<span id="cb4-10"><a href="species-richness-calculations.html#cb4-10"></a><span class="co"># Source any custom/other internal functions necessary for analysis</span></span>
<span id="cb4-11"><a href="species-richness-calculations.html#cb4-11"></a><span class="kw">source</span>(<span class="st">&quot;code/01_internal-functions.R&quot;</span>)</span></code></pre></div>
<p>To start with, we will compute species richness from 3 non-consecutive days for each site for each season (following Campos-Cerqueira et al., 2019)</p>
<p>We will use a excel sheet of annotations, which contains 10s-clips from each site (A random 16-min was chosen between 6am and 10am and divided into 10s chunks for the ease of annotations)</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb5-1"><a href="species-richness-calculations.html#cb5-1"></a><span class="co"># Attach the 2020_summer_annotation data </span></span>
<span id="cb5-2"><a href="species-richness-calculations.html#cb5-2"></a>data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/2020-summer-annotation-working-document.csv&quot;</span>)</span>
<span id="cb5-3"><a href="species-richness-calculations.html#cb5-3"></a></span>
<span id="cb5-4"><a href="species-richness-calculations.html#cb5-4"></a><span class="co"># Site-wise sorting of the 16-min of data</span></span>
<span id="cb5-5"><a href="species-richness-calculations.html#cb5-5"></a><span class="co"># Split the file names into 4 columns : Site, Date, Time and Splits   </span></span>
<span id="cb5-6"><a href="species-richness-calculations.html#cb5-6"></a>data &lt;-<span class="st"> </span><span class="kw">separate</span>(data, <span class="dt">col =</span> Filename, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;Site&quot;</span>, <span class="st">&quot;Date&quot;</span>, <span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Splits&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb5-7"><a href="species-richness-calculations.html#cb5-7"></a>data</span>
<span id="cb5-8"><a href="species-richness-calculations.html#cb5-8"></a></span>
<span id="cb5-9"><a href="species-richness-calculations.html#cb5-9"></a><span class="co"># Load the species-trait-data</span></span>
<span id="cb5-10"><a href="species-richness-calculations.html#cb5-10"></a>trait_dat &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/species-trait-dat.csv&quot;</span>)</span></code></pre></div>
<p>How many visits (counted as number of unique days) to a site has been annotated? Please note that some sites have more than 3 visits to a site, and hence we ensure that we choose only three non-consecutive visits to a given site</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb6-1"><a href="species-richness-calculations.html#cb6-1"></a><span class="co"># At the moment 1-3 days at each site has been annotated</span></span>
<span id="cb6-2"><a href="species-richness-calculations.html#cb6-2"></a><span class="co"># Some sites have only 1 visit. See SEL sites (Selaliparai)</span></span>
<span id="cb6-3"><a href="species-richness-calculations.html#cb6-3"></a><span class="co"># Some sites even have 4 visits, but we will choose 3 random visits only</span></span>
<span id="cb6-4"><a href="species-richness-calculations.html#cb6-4"></a></span>
<span id="cb6-5"><a href="species-richness-calculations.html#cb6-5"></a><span class="co"># Number of visits to a particular site</span></span>
<span id="cb6-6"><a href="species-richness-calculations.html#cb6-6"></a>nSites_Days &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></span>
<span id="cb6-7"><a href="species-richness-calculations.html#cb6-7"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(Site, Date)<span class="op">%&gt;%</span></span>
<span id="cb6-8"><a href="species-richness-calculations.html#cb6-8"></a><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(Site) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(Site)</span>
<span id="cb6-9"><a href="species-richness-calculations.html#cb6-9"></a></span>
<span id="cb6-10"><a href="species-richness-calculations.html#cb6-10"></a><span class="co"># Unique date site combination to give you a sense of sampling</span></span>
<span id="cb6-11"><a href="species-richness-calculations.html#cb6-11"></a>uniqueSiteDate &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></span>
<span id="cb6-12"><a href="species-richness-calculations.html#cb6-12"></a><span class="st">  </span><span class="kw">group_by</span>(Site) <span class="op">%&gt;%</span></span>
<span id="cb6-13"><a href="species-richness-calculations.html#cb6-13"></a><span class="st">  </span><span class="kw">distinct</span>(Date)</span>
<span id="cb6-14"><a href="species-richness-calculations.html#cb6-14"></a></span>
<span id="cb6-15"><a href="species-richness-calculations.html#cb6-15"></a><span class="co"># Convert date column to YMD format using lubridate::ymd()</span></span>
<span id="cb6-16"><a href="species-richness-calculations.html#cb6-16"></a>uniqueSiteDate<span class="op">$</span>Date &lt;-<span class="st"> </span>lubridate<span class="op">::</span><span class="kw">ymd</span>(uniqueSiteDate<span class="op">$</span>Date)</span>
<span id="cb6-17"><a href="species-richness-calculations.html#cb6-17"></a></span>
<span id="cb6-18"><a href="species-richness-calculations.html#cb6-18"></a><span class="co"># The below lines of code were written following a query on stackOverflow to select three non-consecutive visits to any site</span></span>
<span id="cb6-19"><a href="species-richness-calculations.html#cb6-19"></a><span class="co"># Link: https://stackoverflow.com/questions/67212152/select-non-consecutive-dates-for-every-grouped-element-in-r</span></span>
<span id="cb6-20"><a href="species-richness-calculations.html#cb6-20"></a></span>
<span id="cb6-21"><a href="species-richness-calculations.html#cb6-21"></a>nonConVisits &lt;-<span class="st"> </span>uniqueSiteDate<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-22"><a href="species-richness-calculations.html#cb6-22"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-23"><a href="species-richness-calculations.html#cb6-23"></a><span class="st">  </span><span class="kw">group_split</span>(Site) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-24"><a href="species-richness-calculations.html#cb6-24"></a><span class="st">  </span><span class="kw">map_df</span>(., <span class="op">~</span><span class="st"> </span>.x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb6-25"><a href="species-richness-calculations.html#cb6-25"></a><span class="st">           </span><span class="kw">arrange</span>(Date) <span class="op">%&gt;%</span></span>
<span id="cb6-26"><a href="species-richness-calculations.html#cb6-26"></a><span class="st">           </span><span class="kw">mutate</span>(<span class="dt">n =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb6-27"><a href="species-richness-calculations.html#cb6-27"></a><span class="st">           </span><span class="kw">complete</span>(<span class="dt">Date =</span> <span class="kw">seq.Date</span>(<span class="kw">first</span>(Date), <span class="kw">last</span>(Date), <span class="dt">by =</span> <span class="st">&#39;days&#39;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb6-28"><a href="species-richness-calculations.html#cb6-28"></a><span class="st">           </span><span class="kw">group_by</span>(<span class="dt">n =</span> <span class="kw">cumsum</span>(<span class="kw">is.na</span>(n))) <span class="op">%&gt;%</span></span>
<span id="cb6-29"><a href="species-richness-calculations.html#cb6-29"></a><span class="st">           </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(Site)) <span class="op">%&gt;%</span></span>
<span id="cb6-30"><a href="species-richness-calculations.html#cb6-30"></a><span class="st">           </span><span class="kw">filter</span>(<span class="kw">row_number</span>() <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb6-31"><a href="species-richness-calculations.html#cb6-31"></a><span class="st">           </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb6-32"><a href="species-richness-calculations.html#cb6-32"></a><span class="st">           </span><span class="kw">sample_n</span>(<span class="kw">min</span>(<span class="kw">n</span>(), <span class="dv">3</span>))</span>
<span id="cb6-33"><a href="species-richness-calculations.html#cb6-33"></a>         ) <span class="op">%&gt;%</span></span>
<span id="cb6-34"><a href="species-richness-calculations.html#cb6-34"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>n)</span>
<span id="cb6-35"><a href="species-richness-calculations.html#cb6-35"></a></span>
<span id="cb6-36"><a href="species-richness-calculations.html#cb6-36"></a><span class="co"># Change the structure of the date column back to character for using one of the join functions</span></span>
<span id="cb6-37"><a href="species-richness-calculations.html#cb6-37"></a>nonConVisits<span class="op">$</span>Date &lt;-<span class="st"> </span><span class="kw">str_remove_all</span>(<span class="kw">as.character</span>(nonConVisits<span class="op">$</span>Date),<span class="st">&quot;-&quot;</span>)</span>
<span id="cb6-38"><a href="species-richness-calculations.html#cb6-38"></a></span>
<span id="cb6-39"><a href="species-richness-calculations.html#cb6-39"></a><span class="co"># Left-join with the original dataframe to subset the data for analysis</span></span>
<span id="cb6-40"><a href="species-richness-calculations.html#cb6-40"></a>datSubset &lt;-<span class="st"> </span><span class="kw">left_join</span>(nonConVisits,data)</span>
<span id="cb6-41"><a href="species-richness-calculations.html#cb6-41"></a></span>
<span id="cb6-42"><a href="species-richness-calculations.html#cb6-42"></a><span class="co"># Save this data as a .csv for future analysis (later scripts)</span></span>
<span id="cb6-43"><a href="species-richness-calculations.html#cb6-43"></a><span class="kw">write.csv</span>(datSubset,<span class="st">&quot;data/datSubset.csv&quot;</span>, <span class="dt">row.names =</span> F)</span></code></pre></div>
<p>Now group the data by site and restoration type and sum the number of detections across sites. At the moment, we will calculate the overall number of detections for each 10s clip, which will be used to estimate species richness below.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb7-1"><a href="species-richness-calculations.html#cb7-1"></a><span class="co"># Calculate the overall number of detections for each site across 1-3 days of data (translates to 16min to 48min of data per site)</span></span>
<span id="cb7-2"><a href="species-richness-calculations.html#cb7-2"></a><span class="co"># We would like to obtain a max of 3 visits to a site only (some sites have 4 visits)</span></span>
<span id="cb7-3"><a href="species-richness-calculations.html#cb7-3"></a></span>
<span id="cb7-4"><a href="species-richness-calculations.html#cb7-4"></a>nDetections_Site &lt;-<span class="st"> </span>datSubset <span class="op">%&gt;%</span></span>
<span id="cb7-5"><a href="species-richness-calculations.html#cb7-5"></a><span class="st">  </span><span class="kw">group_by</span>(Site, Restoration.Type) <span class="op">%&gt;%</span></span>
<span id="cb7-6"><a href="species-richness-calculations.html#cb7-6"></a><span class="st">  </span><span class="kw">transform</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">replace</span>(<span class="kw">is.na</span>(.), <span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb7-7"><a href="species-richness-calculations.html#cb7-7"></a><span class="st">  </span><span class="kw">summarise_at</span>(<span class="dt">.vars =</span> <span class="kw">vars</span>(<span class="kw">c</span>(<span class="st">&quot;IP&quot;</span><span class="op">:</span><span class="st">&quot;CR&quot;</span>)),<span class="dt">.funs =</span> sum) </span>
<span id="cb7-8"><a href="species-richness-calculations.html#cb7-8"></a>  </span></code></pre></div>
<p>Convert the detections to 1, since we are interested in calculating richness per site by converting values &gt;1 to 1 for multiple visits to a site. In other words, we want to establish overall species richness for a 16-min to 48-min window.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb8-1"><a href="species-richness-calculations.html#cb8-1"></a>richness &lt;-<span class="st"> </span>nDetections_Site  <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb8-2"><a href="species-richness-calculations.html#cb8-2"></a><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">c</span>(<span class="st">&quot;IP&quot;</span><span class="op">:</span><span class="st">&quot;CR&quot;</span>)),<span class="op">~</span><span class="st"> </span><span class="kw">replace</span>(., . <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb8-3"><a href="species-richness-calculations.html#cb8-3"></a><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb8-4"><a href="species-richness-calculations.html#cb8-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">richness =</span> <span class="kw">sum</span>(<span class="kw">c_across</span>(IP<span class="op">:</span>CR))) <span class="op">%&gt;%</span></span>
<span id="cb8-5"><a href="species-richness-calculations.html#cb8-5"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(Site, Restoration.Type, richness)</span>
<span id="cb8-6"><a href="species-richness-calculations.html#cb8-6"></a></span>
<span id="cb8-7"><a href="species-richness-calculations.html#cb8-7"></a><span class="co"># Test if there are significant differences in richness across treatment types</span></span>
<span id="cb8-8"><a href="species-richness-calculations.html#cb8-8"></a>anovaAll &lt;-<span class="st"> </span><span class="kw">aov</span>(richness<span class="op">~</span>Restoration.Type, <span class="dt">data =</span> richness)</span>
<span id="cb8-9"><a href="species-richness-calculations.html#cb8-9"></a></span>
<span id="cb8-10"><a href="species-richness-calculations.html#cb8-10"></a><span class="co"># Tukey test to study each pair of treatment - reveals no signficant difference across treatment types</span></span>
<span id="cb8-11"><a href="species-richness-calculations.html#cb8-11"></a>tukeyAll &lt;-<span class="st"> </span><span class="kw">TukeyHSD</span>(anovaAll)</span>
<span id="cb8-12"><a href="species-richness-calculations.html#cb8-12"></a></span>
<span id="cb8-13"><a href="species-richness-calculations.html#cb8-13"></a><span class="co"># The above result suggests that there are no differences in overall species richness across treatment types</span></span>
<span id="cb8-14"><a href="species-richness-calculations.html#cb8-14"></a></span>
<span id="cb8-15"><a href="species-richness-calculations.html#cb8-15"></a><span class="co"># Create a boxplot of species richness by group (Here: group refers to Restoration Type)</span></span>
<span id="cb8-16"><a href="species-richness-calculations.html#cb8-16"></a><span class="co"># Temporary plots based on uneven visits to a site. Note it ranges from 1 to 3 visits.</span></span>
<span id="cb8-17"><a href="species-richness-calculations.html#cb8-17"></a></span>
<span id="cb8-18"><a href="species-richness-calculations.html#cb8-18"></a>fig_richness &lt;-<span class="st"> </span><span class="kw">ggplot</span>(richness, <span class="kw">aes</span>(<span class="dt">x=</span>Restoration.Type, <span class="dt">y=</span>richness, <span class="dt">fill=</span>Restoration.Type)) <span class="op">+</span><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">alpha=</span><span class="fl">0.7</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb8-19"><a href="species-richness-calculations.html#cb8-19"></a><span class="st">    </span><span class="kw">scale_fill_scico_d</span>(<span class="dt">palette =</span> <span class="st">&quot;roma&quot;</span>) <span class="op">+</span></span>
<span id="cb8-20"><a href="species-richness-calculations.html#cb8-20"></a><span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb8-21"><a href="species-richness-calculations.html#cb8-21"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Restoration Type&quot;</span>, </span>
<span id="cb8-22"><a href="species-richness-calculations.html#cb8-22"></a>       <span class="dt">y=</span><span class="st">&quot;Species Richness&quot;</span>) <span class="op">+</span></span>
<span id="cb8-23"><a href="species-richness-calculations.html#cb8-23"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">16</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>), </span>
<span id="cb8-24"><a href="species-richness-calculations.html#cb8-24"></a>        <span class="dt">axis.ticks.length.x =</span> <span class="kw">unit</span>(.<span class="dv">5</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb8-25"><a href="species-richness-calculations.html#cb8-25"></a>        <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">14</span>),</span>
<span id="cb8-26"><a href="species-richness-calculations.html#cb8-26"></a>        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb8-27"><a href="species-richness-calculations.html#cb8-27"></a>        <span class="dt">legend.key.size =</span> <span class="kw">unit</span>(<span class="dv">1</span>,<span class="st">&quot;cm&quot;</span>),</span>
<span id="cb8-28"><a href="species-richness-calculations.html#cb8-28"></a>        <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>))</span>
<span id="cb8-29"><a href="species-richness-calculations.html#cb8-29"></a></span>
<span id="cb8-30"><a href="species-richness-calculations.html#cb8-30"></a><span class="kw">ggsave</span>(fig_richness, <span class="dt">filename =</span> <span class="st">&quot;figs/fig_richness.png&quot;</span>, <span class="dt">width=</span><span class="dv">12</span>, <span class="dt">height=</span><span class="dv">7</span>,</span>
<span id="cb8-31"><a href="species-richness-calculations.html#cb8-31"></a>       <span class="dt">device =</span> <span class="kw">png</span>(), <span class="dt">units=</span><span class="st">&quot;in&quot;</span>, <span class="dt">dpi =</span> <span class="dv">300</span>);<span class="kw">dev.off</span>()</span>
<span id="cb8-32"><a href="species-richness-calculations.html#cb8-32"></a></span>
<span id="cb8-33"><a href="species-richness-calculations.html#cb8-33"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;figs/fig_richness.png&quot;</span>)</span>
<span id="cb8-34"><a href="species-richness-calculations.html#cb8-34"></a></span>
<span id="cb8-35"><a href="species-richness-calculations.html#cb8-35"></a><span class="co"># We observe that the overall species richness is relatively higher in passively restored forest patches, followed by benchmark (protected area) forest patches and actively restored forest patches (But these differences are not significant)</span></span></code></pre></div>
<p>Using species trait data to check if species richness varies by treatment type as a function of whether a species is a rainforest specialist vs.Â open-country specialist.
To do so: Add an additional column of species-trait data and group data based on the same.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb9-1"><a href="species-richness-calculations.html#cb9-1"></a><span class="co"># First, we pivot the species-codes and then match the codes with trait_data and reformat the data to keep all detections&gt;0 as 1 else they are 0</span></span>
<span id="cb9-2"><a href="species-richness-calculations.html#cb9-2"></a></span>
<span id="cb9-3"><a href="species-richness-calculations.html#cb9-3"></a>richness_trait &lt;-<span class="st"> </span>nDetections_Site <span class="op">%&gt;%</span></span>
<span id="cb9-4"><a href="species-richness-calculations.html#cb9-4"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols=</span>IP<span class="op">:</span>CR, <span class="dt">names_to=</span><span class="st">&quot;Species_Code&quot;</span>, <span class="dt">values_to=</span><span class="st">&quot;count&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb9-5"><a href="species-richness-calculations.html#cb9-5"></a><span class="st">  </span><span class="kw">left_join</span>(.,trait_dat, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;Species_Code&quot;</span>=<span class="st">&quot;species_annotation_codes&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb9-6"><a href="species-richness-calculations.html#cb9-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">forRichness =</span> <span class="kw">case_when</span>(count<span class="op">&gt;</span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb9-7"><a href="species-richness-calculations.html#cb9-7"></a>                                 count<span class="op">==</span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>))</span>
<span id="cb9-8"><a href="species-richness-calculations.html#cb9-8"></a></span>
<span id="cb9-9"><a href="species-richness-calculations.html#cb9-9"></a><span class="co"># Calculate overall richness for each site as a function of rainforest species and open-country species</span></span>
<span id="cb9-10"><a href="species-richness-calculations.html#cb9-10"></a></span>
<span id="cb9-11"><a href="species-richness-calculations.html#cb9-11"></a>richness_trait &lt;-<span class="st">  </span>richness_trait <span class="op">%&gt;%</span></span>
<span id="cb9-12"><a href="species-richness-calculations.html#cb9-12"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(Site, Restoration.Type, Species_Code, Habitat, forRichness) <span class="op">%&gt;%</span></span>
<span id="cb9-13"><a href="species-richness-calculations.html#cb9-13"></a><span class="st">  </span><span class="kw">group_by</span>(Site, Restoration.Type, Habitat) <span class="op">%&gt;%</span></span>
<span id="cb9-14"><a href="species-richness-calculations.html#cb9-14"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">richness =</span> <span class="kw">sum</span>(forRichness))</span>
<span id="cb9-15"><a href="species-richness-calculations.html#cb9-15"></a></span>
<span id="cb9-16"><a href="species-richness-calculations.html#cb9-16"></a><span class="co"># Let&#39;s subset data for richness as a function of rainforest specialists and open-country generalists and test for significant differences (if any)</span></span>
<span id="cb9-17"><a href="species-richness-calculations.html#cb9-17"></a>richness_rainforest &lt;-<span class="st"> </span>richness_trait <span class="op">%&gt;%</span></span>
<span id="cb9-18"><a href="species-richness-calculations.html#cb9-18"></a><span class="st">  </span><span class="kw">filter</span>(Habitat<span class="op">==</span><span class="st">&quot;RF&quot;</span>)</span>
<span id="cb9-19"><a href="species-richness-calculations.html#cb9-19"></a></span>
<span id="cb9-20"><a href="species-richness-calculations.html#cb9-20"></a>richness_opencountry &lt;-<span class="st"> </span>richness_trait <span class="op">%&gt;%</span></span>
<span id="cb9-21"><a href="species-richness-calculations.html#cb9-21"></a><span class="st">  </span><span class="kw">filter</span>(Habitat<span class="op">==</span><span class="st">&quot;OC&quot;</span>)</span>
<span id="cb9-22"><a href="species-richness-calculations.html#cb9-22"></a></span>
<span id="cb9-23"><a href="species-richness-calculations.html#cb9-23"></a><span class="co"># Test if there are significant differences in richness across treatment types as a function of species trait</span></span>
<span id="cb9-24"><a href="species-richness-calculations.html#cb9-24"></a>anova_rainforest &lt;-<span class="st"> </span><span class="kw">aov</span>(richness<span class="op">~</span>Restoration.Type, <span class="dt">data =</span> richness_rainforest)</span>
<span id="cb9-25"><a href="species-richness-calculations.html#cb9-25"></a>anova_opencountry &lt;-<span class="st"> </span><span class="kw">aov</span>(richness<span class="op">~</span>Restoration.Type, <span class="dt">data =</span> richness_opencountry)</span>
<span id="cb9-26"><a href="species-richness-calculations.html#cb9-26"></a></span>
<span id="cb9-27"><a href="species-richness-calculations.html#cb9-27"></a><span class="co"># Tukey test to study each pair of treatment - reveals no signficant difference across treatment types</span></span>
<span id="cb9-28"><a href="species-richness-calculations.html#cb9-28"></a>tukey_rainforest &lt;-<span class="st"> </span><span class="kw">TukeyHSD</span>(anova_rainforest)</span>
<span id="cb9-29"><a href="species-richness-calculations.html#cb9-29"></a>tukey_opencountry &lt;-<span class="st"> </span><span class="kw">TukeyHSD</span>(anova_opencountry)</span>
<span id="cb9-30"><a href="species-richness-calculations.html#cb9-30"></a></span>
<span id="cb9-31"><a href="species-richness-calculations.html#cb9-31"></a><span class="co"># Plot the above result</span></span>
<span id="cb9-32"><a href="species-richness-calculations.html#cb9-32"></a>fig_richness_trait &lt;-<span class="st"> </span><span class="kw">ggplot</span>(richness_trait, <span class="kw">aes</span>(<span class="dt">x=</span>Restoration.Type, <span class="dt">y=</span>richness, <span class="dt">fill=</span>Habitat)) <span class="op">+</span></span>
<span id="cb9-33"><a href="species-richness-calculations.html#cb9-33"></a><span class="st">    </span><span class="kw">geom_boxplot</span>(<span class="dt">alpha=</span><span class="fl">0.7</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb9-34"><a href="species-richness-calculations.html#cb9-34"></a><span class="st">    </span><span class="kw">scale_fill_scico_d</span>(<span class="dt">palette =</span> <span class="st">&quot;roma&quot;</span>) <span class="op">+</span></span>
<span id="cb9-35"><a href="species-richness-calculations.html#cb9-35"></a><span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb9-36"><a href="species-richness-calculations.html#cb9-36"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Restoration Type&quot;</span>, </span>
<span id="cb9-37"><a href="species-richness-calculations.html#cb9-37"></a>       <span class="dt">y=</span><span class="st">&quot;Species Richness&quot;</span>) <span class="op">+</span></span>
<span id="cb9-38"><a href="species-richness-calculations.html#cb9-38"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">16</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>), </span>
<span id="cb9-39"><a href="species-richness-calculations.html#cb9-39"></a>        <span class="dt">axis.ticks.length.x =</span> <span class="kw">unit</span>(.<span class="dv">5</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb9-40"><a href="species-richness-calculations.html#cb9-40"></a>        <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">14</span>),</span>
<span id="cb9-41"><a href="species-richness-calculations.html#cb9-41"></a>        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb9-42"><a href="species-richness-calculations.html#cb9-42"></a>        <span class="dt">legend.key.size =</span> <span class="kw">unit</span>(<span class="dv">1</span>,<span class="st">&quot;cm&quot;</span>),</span>
<span id="cb9-43"><a href="species-richness-calculations.html#cb9-43"></a>        <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>))</span>
<span id="cb9-44"><a href="species-richness-calculations.html#cb9-44"></a></span>
<span id="cb9-45"><a href="species-richness-calculations.html#cb9-45"></a><span class="kw">ggsave</span>(fig_richness_trait, <span class="dt">filename =</span> <span class="st">&quot;figs/fig_richness_trait.png&quot;</span>, <span class="dt">width=</span><span class="dv">12</span>, <span class="dt">height=</span><span class="dv">7</span>,<span class="dt">device =</span> <span class="kw">png</span>(), <span class="dt">units=</span><span class="st">&quot;in&quot;</span>, <span class="dt">dpi =</span> <span class="dv">300</span>); <span class="kw">dev.off</span>()</span>
<span id="cb9-46"><a href="species-richness-calculations.html#cb9-46"></a></span>
<span id="cb9-47"><a href="species-richness-calculations.html#cb9-47"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;figs/fig_richness_trait.png&quot;</span>)</span></code></pre></div>
<p>To make final plots, please use a combination of ggpubr and cowplot (TO BE DONE)</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb10-1"><a href="species-richness-calculations.html#cb10-1"></a>mycolours &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#440154FF&quot;</span>, <span class="st">&quot;#21908CFF&quot;</span>, <span class="st">&quot;orange&quot;</span>)</span>
<span id="cb10-2"><a href="species-richness-calculations.html#cb10-2"></a></span>
<span id="cb10-3"><a href="species-richness-calculations.html#cb10-3"></a>trial &lt;-<span class="st"> </span><span class="kw">ggplot</span>(richness_rainforest, <span class="kw">aes</span>(<span class="dt">x=</span>Restoration.Type, <span class="dt">y=</span>richness, <span class="dt">fill =</span> Restoration.Type)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb10-4"><a href="species-richness-calculations.html#cb10-4"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">alpha =</span> <span class="fl">0.75</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb10-5"><a href="species-richness-calculations.html#cb10-5"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb10-6"><a href="species-richness-calculations.html#cb10-6"></a><span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;BM&#39;</span>,<span class="st">&#39;AR&#39;</span>,<span class="st">&#39;NR&#39;</span>)) <span class="op">+</span></span>
<span id="cb10-7"><a href="species-richness-calculations.html#cb10-7"></a><span class="st">  </span><span class="kw">rremove</span>(<span class="st">&quot;x.text&quot;</span>) <span class="op">+</span></span>
<span id="cb10-8"><a href="species-richness-calculations.html#cb10-8"></a><span class="st">  </span><span class="kw">rremove</span>(<span class="st">&quot;ylab&quot;</span>) <span class="op">+</span></span>
<span id="cb10-9"><a href="species-richness-calculations.html#cb10-9"></a><span class="st">  </span><span class="kw">rremove</span>(<span class="st">&quot;xlab&quot;</span>) <span class="op">+</span></span>
<span id="cb10-10"><a href="species-richness-calculations.html#cb10-10"></a><span class="st">  </span><span class="kw">ylim</span> (<span class="ot">NA</span>, <span class="dv">52</span>) <span class="op">+</span></span>
<span id="cb10-11"><a href="species-richness-calculations.html#cb10-11"></a><span class="st">  </span><span class="kw">labs</span> (<span class="dt">x =</span> <span class="st">&quot;Rainforest species&quot;</span>) <span class="op">+</span></span>
<span id="cb10-12"><a href="species-richness-calculations.html#cb10-12"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> mycolours, <span class="dt">name =</span> <span class="st">&quot;Strata&quot;</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;BM&#39;</span>,<span class="st">&#39;AR&#39;</span>,<span class="st">&#39;NR&#39;</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">stat_summary</span>(<span class="dt">geom =</span> <span class="st">&#39;text&#39;</span>, <span class="dt">label =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;b&quot;</span>), <span class="dt">fun =</span> max, <span class="dt">vjust =</span> <span class="dv">-1</span>)</span></code></pre></div>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="splitting-large-wav-files-into-smaller-chunks.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="acoustic-detections.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/vjjan91/acoustics-westernGhats/edit/master/02-species-richness.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
